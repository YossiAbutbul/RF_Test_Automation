# ---------- Compatibility keys for split runners (added, nothing removed) ----------
defaults:
  spectrum:
    marker: "MARK1"
    default_delay_s: 0.15

# Global analyzer reference offset (read by tests_common.get_global_analyzer_ref_offset_db)
analyzer_analyzer_ref_offset_db: 25.5  


# ---------- All test configs live under this key (used by get_test_config) ----------
tests:
  # ===== LoRa: Tx Power =====
  tx_power:
    analyzer_setup:
      span_hz: 5000000
      rbw_hz: 300000
      vbw_hz: 1000000
      ref_level_dbm: 30.0
      use_peak_detector: true
    settle:
      after_center_s: 0.250
      after_lora_cw_on_s: 0.60

  # ===== LoRa: Frequency Accuracy (3 zooms) =====
  frequency_accuracy:
    analyzer_setup:
      span_hz: 2000000
      rbw_hz: 300000
      vbw_hz: 100000
      ref_level_dbm: 20.0
      use_peak_detector: true
    base:
      settle_after_center_s: 0.250
      settle_after_lora_cw_on_s: 0.40
    settle:
      after_center_s: 0.250
      after_lora_cw_on_s: 0.40
    zooms:
      - span_hz: 2000000
        rbw_hz: 300000
        vbw_hz: 100000
        delay_s: 0.250
      - span_hz: 200000
        rbw_hz: 10000
        vbw_hz: 300000
        delay_s: 0.250
      - span_hz: 20000
        rbw_hz: 1000
        vbw_hz: 3000
        delay_s: 0.250

  # ===== LTE: Tx Power =====
  lte_defaults:
    analyzer_setup:
      span_hz: 2000000
      rbw_hz: 300000
      vbw_hz: 100000
      ref_level_dbm: 25.0
      use_peak_detector: true
    settle_after_cw_on_s: 0.30
    # ---- Modem readiness + retry tunables ----
    modem_ready_base_wait_s: 0.60       # wait after modemOn before first abort
    modem_ready_extra_wait_s: 0.40      # extra wait if the quick abort probe fails
    abort_retries: 3                    # safety abort retries
    abort_backoff_s: 0.35               # backoff between abort retries
    cw_retries: 3                       # cw_on retries
    cw_backoff_s: 0.35                  # backoff between cw_on retries

  # ===== LTE: Frequency Accuracy =====
  lte_frequency_accuracy:
    analyzer_setup:
      span_hz: 2000000
      rbw_hz: 300000
      vbw_hz: 100000
      ref_level_dbm: 25.0
      use_peak_detector: true
    base:
      settle_after_center_s: 0.250
      settle_after_lte_modem_on_s: 0.30
      settle_after_lte_cw_on_s: 0.40
      modem_ready_base_wait_s: 0.60     # wait after modemOn before first abort
      modem_ready_extra_wait_s: 0.40    # extra wait if the quick abort probe fails
      abort_retries: 3                  # safety abort retries
      abort_backoff_s: 0.35             # backoff between abort retries
      cw_retries: 3                     # cw_on retries
      cw_backoff_s: 0.35                # backoff between cw_on retries
    zooms:
      - span_hz: 2000000
        rbw_hz: 300000
        vbw_hz: 100000
        delay_s: 0.250
      - span_hz: 200000
        rbw_hz: 10000
        vbw_hz: 300000
        delay_s: 0.250
      - span_hz: 20000
        rbw_hz: 1000
        vbw_hz: 3000
        delay_s: 0.250

  # ===== LTE: EARFCN → Frequency (Hz) map =====
  lte_earfcn_map:
    # EARFCN → Frequency (Hz) mappings for Band 12
    23010: 699000000   # 699 MHz
    23095: 707500000   # 707.5 MHz
    23179: 715900000   # 715.9 MHz

    # EARFCN → Frequency (Hz) mappings for Band 4
    19950: 1710000000  # 1710 MHz
    20175: 1732500000  # 1732.5 MHz
    20399: 1754900000  # 1754.9 MHz

    # EARFCN → Frequency (Hz) mappings for Band 2
    18600: 1850000000  # 1850 MHz
    18900: 1880000000  # 1880 MHz
    19199: 1909900000  # 1909.9 MHz

  # ===== BLE: Tx Power =====
  ble_defaults:
    settle_after_power_set_s: 0.30
    settle_after_test_tone_s: 0.50

  ble_tx_power:
    simple_cw_mode: true
    duration_s: 6.0
    tone_settle_s: 0.30
    measure_settle_s: 0.12
    offset_hz: 0
    reconnect_attempts: 2
    analyzer_setup:
      span_hz: 5000000
      rbw_hz: 100000
      vbw_hz: 100000
      ref_level_dbm: 5
    settle:
      after_center_s: 0.25

  # ===== BLE: Frequency Accuracy (new, 3 zooms like LoRa) =====
  ble_frequency_accuracy:
    analyzer_setup:
      span_hz: 2000000
      rbw_hz: 300000
      vbw_hz: 100000
      ref_level_dbm: 20.0
      use_peak_detector: true
    after_center_s: 0.250
    tone_duration_ms: 15000
    offset_hz: 0
    measure_settle_s: 0.10
    zoom_delay_s: 0.250
    zooms:
      - span_hz: 2000000
        rbw_hz: 300000
        vbw_hz: 100000
        delay_s: 0.250
      - span_hz: 200000
        rbw_hz: 10000
        vbw_hz: 300000
        delay_s: 0.250
      - span_hz: 20000
        rbw_hz: 1000
        vbw_hz: 3000
        delay_s: 0.250
